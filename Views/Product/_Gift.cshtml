@model IEnumerable<WoodyIconShopModel.Models.ProductGift>
@{
    WoodyIconShopModel.Models.ShopConfig shopConfig = ViewBag.shopConfig;
    int giftCount = Model.Count() == 0 ? 0 : Model.ElementAt(0).GiftCount;
}
@if (Model.Count() > 0)
{

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">贈品</h3>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-xs-12">
                <div class="row gift" id="product_gift">
                    @{ 
                        int giftCountlast = giftCount;
                    }
                    @foreach (var gift in Model)
                    {

                        WoodyIconShopModel.Models.ProductImage image = gift.Gift.ProductImage.Where(pi => pi.Main && pi.ImageSetting != null && pi.ImageSetting.IsEnable).FirstOrDefault();
                        string imageurl = Url.Content("~/Content/images/transparent.png");
                        if (image != null)
                        {
                            imageurl = Url.Content(shopConfig.ServerImgPath + image.ImageSetting.Name);
                        }

                        <div class="col-xs-6 col-sm-2">
                            <div class="thumbnail @(giftCountlast > 0 ? "selected" : "")">
                                <div>
                                    <img src="@imageurl" alt="@gift.Gift.Name" style="width:100%">
                                    <div class="caption">
                                        <input type="hidden" value="@gift.Id" />
                                        <a href="@Url.Action("ProductDetail", "Product", new { Id = gift.GiftId })" target="_blank" ><div class="thumbnail-title" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">@gift.Gift.Name</div></a>
                                        <button type="button" class="btn @(giftCountlast > 0 ? "btn-default" : "btn-custom") btn-block thumbnail-btn" onclick="choose_gift(this)" >選取</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        giftCountlast--;
                    }
                </div>
            </div>
        </div>
    </div>
</div>

}

<script>
    function choose_gift(btn) {
        var gift = $('#product_gift');
        

        //沒選要選
        if ($(btn).hasClass("btn-custom")) {

            if (gift.find('.thumbnail.selected div.caption button').length < @giftCount) {

                $(btn).removeClass('btn-custom');
                $(btn).addClass('btn-default');
                $(btn).closest('.thumbnail').addClass('selected');
            }
        }
        //選了要取消
        else {
            $(btn).removeClass('btn-default');
            $(btn).addClass('btn-custom');
            $(btn).closest('.thumbnail').removeClass('selected');
        }


        
    }
</script>